{% extends "index.html.twig" %}

{% block body %}

<section id="hero" class="register d-flex align-items-end">
    <div class="carousel-item active">
        <div class="carousel-container">
            <h2 class="animate__animated animate__fadeInDown">{{ title }}</h2>
            <p class="animate__animated animate__fadeInUp">{{ subtitle }}</p>
        </div>
    </div>
</section>

<main id="main">
    <section id="icon-boxes" class="icon-boxes" style="padding-top:20px;">
        <div class="container">
            {% for realty in realties %}
                <div class="row d-flex justify-content-center mt-5">

                    <!-- Informations -->

                    {% if is_granted('ROLE_LOCATAIRE') %}
                        <div class="col-md-6 col-lg-3 d-flex align-items-stretch mb-5 mb-lg-0 aos-init aos-animate" data-aos="fade-up">
                            <div class="icon-box" style="width:100%;">
                                <h4 class="title">{% trans %}Informations{% endtrans %}</h4>
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item"><strong>{{ realty.title }}</strong></li>
                                    <li class="list-group-item">{{ realty.description }}</li>
                                    <li class="list-group-item">Loyer : {{ realty.rent }}€ / Mois</li>
                                </ul>
                                {% if is_granted('ROLE_PROPRIETAIRE') %}
                                    <div class="btn-group btn-group-sm d-flex justify-content-center" role="group">
                                        <a href="{{ path('rental.update', {idOwner: realty.id}) }}" class="btn btn-outline-primary" style="font-size:1.05rem;">{% trans %}Modifier{% endtrans %}</a>
                                        <form method="POST" action="{{ path('rental.remove', {idOwner: realty.id}) }}">
                                            <input type="hidden" name="_method" value="DELETE"/>
                                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ realty.id)}}"/>
                                            <button class="btn btn-danger" style="border-top-left-radius:0;border-bottom-left-radius:0;">{% trans %}Supprimer{% endtrans %}</button>
                                        </form>
                                    </div>
                                {% endif %}
                                <hr/>
                                {% if realty.images|length != 0 %}
                                    <div id="carousel{{ realty.id }}" class="carousel slide" data-bs-ride="carousel">
                                        <div class="carousel-inner">
                                            {% for image in realty.images %}
                                                <div class="carousel-item">
                                                    <img src="{{ asset('uploads/png/' ~ image.url) }}" class="d-block w-100 img-fluid img-thumbnail">
                                                </div>
                                            {% endfor %}
                                        </div>
                                        <button class="carousel-control-prev" type="button" data-bs-target="#carousel{{ realty.id }}" data-bs-slide="prev">
                                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Previous</span>
                                        </button>
                                        <button class="carousel-control-next" type="button" data-bs-target="#carousel{{ realty.id }}" data-bs-slide="next">
                                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Next</span>
                                        </button>
                                    </div>
                                {% endif %}
                                {% if realty.documents|length != 0 %}
                                    <ul class="list-group list-group-flush">
                                    {% for document in realty.documents %}
                                        <li class="list-group-item">
                                            <i class='bx bxs-file-pdf'></i>
                                            <a href="{{ asset('uploads/pdf/' ~ document.url) }}">{{ document.url }}</a>
                                            {% if is_granted('ROLE_PROPRIETAIRE') %}
                                                <a href="#">{DEL}</a>
                                            {% endif %}
                                        </li>
                                    {% endfor %}
                                    </ul>
                                {% endif %}
                                {% if is_granted('ROLE_PROPRIETAIRE') %}
                                    <div class="btn-group btn-group-sm d-flex justify-content-center" role="group">
                                        <a href="{{ path('rental.upload.image', {idRent: realty.id}) }}" class="btn btn-primary">{% trans %}Ajouter une photo{% endtrans %}</a>
                                        <a href="{{ path('rental.upload.document', {idRent: realty.id}) }}" class="btn btn-primary">{% trans %}Ajouter un document{% endtrans %}</a>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}

                    <!-- Statut -->

                    {% if is_granted('ROLE_PROPRIETAIRE') %}
                        <div class="col-md-6 col-lg-3 d-flex align-items-stretch mb-5 mb-lg-0 aos-init aos-animate" data-aos="fade-up" data-aos-delay="100">
                            <div class="icon-box" style="width:100%;">
                                <h4 class="title">Statut</h4>
                                <p class="description">{{ ["","En attente de validation par l'agence.", "En attente de publication.", "En attente de locataire.", "Confirmer la location.", "LOUER"][realty.statut] }}</p>
                                {% if is_granted('ROLE_BAILLEUR_TIERS') %}
                                    {% if realty.statut == 2 %}
                                        <div class="btn-group btn-group-sm d-flex justify-content-center" role="group">
                                            <a href="{{ path('rental.post', {idOwner: realty.id}) }}" class="btn btn-primary mt-4">{% trans %}Publier l'annonce{% endtrans %}</a>
                                        </div>
                                    {% elseif realty.statut == 4 %}
                                        <div class="btn-group btn-group-sm d-flex justify-content-center" role="group">
                                            <a href="{{ path('rental.canceled', {idRent: realty.id}) }}" class="btn btn-primary mt-4">{% trans %}Annuler la demande{% endtrans %}</a>
                                            <a href="{{ path('rental.accepted', {idRent: realty.id}) }}" class="btn btn-primary mt-4">{% trans %}Confirmer la demande{% endtrans %}</a>
                                        </div>
                                    {% elseif realty.statut == 5 %}
                                        <div class="btn-group btn-group-sm d-flex justify-content-center" role="group">
                                            <a href="{{ path('rental.canceled', {idRent: realty.id}) }}" class="btn btn-primary mt-4">{% trans %}Annuler la location{% endtrans %}</a>
                                        </div>
                                    {% endif %}
                                {% elseif is_granted('ROLE_PROPRIETAIRE') %}
                                    <div class="btn-group btn-group-sm d-flex justify-content-center" role="group">
                                        <a href="{{ path('owner.contact.agency', {idOwner: realty.id}) }}" class="btn btn-primary mt-4">{% trans %}Contacter l'agence{% endtrans %}</a>
                                    </div>
                                {% endif %}
                                {% if is_granted('ROLE_AGENCE') %}
                                    {% if realty.idOwner != realty.idAgency %}
                                        <div class="btn-group btn-group-sm d-flex justify-content-center" role="group">
                                            <a href="{{ path('agency.contact.owner', {idOwner: realty.id}) }}" class="btn btn-primary mt-4">{% trans %}Contacter le propriétaire{% endtrans %}</a>
                                        </div>
                                    {% endif %}
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}

                    <!-- Messageries (LOCATAIRE) -->

                    {% if is_granted('ROLE_LOCATAIRE') and not is_granted('ROLE_PROPRIETAIRE') %}
                        {% if realty.idOwner %}
                            <div class="col-md-6 col-lg-3 d-flex align-items-stretch mb-5 mb-lg-0 aos-init aos-animate" data-aos="fade-up" data-aos-delay="100">
                                <div class="icon-box" style="width:100%;">
                                    <h4 class="title">Messageries</h4>
                                    <ul class="nav nav-tabs myTab" id="myTab" data-bs-target="#myTabContent1" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="home" type="button" role="tab" aria-controls="home" aria-selected="true">Propriétaire</button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="loyer-tab" data-bs-toggle="tab" data-bs-target="loyer" type="button" role="tab" aria-controls="loyer" aria-selected="false">Loyer</button>
                                        </li>
                                    </ul>
                                    <div class="tab-content" id="myTabContent1">
                                        <div class="tab-pane fade show active text-center" id="home" role="tabpanel" aria-labelledby="home-tab">
                                            <strong>{{ realty.idOwner.lastname }} {{ realty.idOwner.firstname }}</strong>
                                            <div><a href="{{ path('owner.contact', {idOwner: realty.id}) }}" class="btn btn-primary mt-4">{% trans %}Contacter le propriétaire{% endtrans %}</a></div>
                                        </div>
                                        <div class="tab-pane fade text-center" id="loyer" role="tabpanel" aria-labelledby="contact-tab">
                                            {% if realty.statut == 5 %}
                                                <a href="{{ path('rental.accepted', {idRent: realty.id}) }}" class="btn btn-primary mt-4">{% trans %}Demander d'échelonner le loyer{% endtrans %}</a>
                                            {% else %}
                                                <p class="alert alert-warning">En attente de confirmation par le propriétaire.</p>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    {% endif %}

                    <!-- Messageries (PROPRIETAIRE) -->

                    {% if is_granted('ROLE_PROPRIETAIRE') %}
                        {% if realty.idTenant %}
                            <div class="col-md-6 col-lg-3 d-flex align-items-stretch mb-5 mb-lg-0 aos-init aos-animate" data-aos="fade-up" data-aos-delay="100">
                                <div class="icon-box" style="width:100%;">
                                    <h4 class="title">Messageries</h4>
                                    <ul class="nav nav-tabs myTab" id="myTab" data-bs-target="#myTabContent1" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="home" type="button" role="tab" aria-controls="home" aria-selected="true">Locataire</button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="loyer-tab" data-bs-toggle="tab" data-bs-target="loyer" type="button" role="tab" aria-controls="loyer" aria-selected="false">Loyer</button>
                                        </li>
                                    </ul>
                                    <div class="tab-content" id="myTabContent1">
                                        <div class="tab-pane fade show active text-center" id="home" role="tabpanel" aria-labelledby="home-tab">
                                            <strong>{{ realty.idTenant.lastname }} {{ realty.idTenant.firstname }}</strong>
                                            <a href="{{ path('owner.contact', {idOwner: realty.id}) }}" class="btn btn-primary mt-4">{% trans %}Contacter le locataire{% endtrans %}</a>
                                        </div>
                                        <div class="tab-pane fade text-center" id="loyer" role="tabpanel" aria-labelledby="contact-tab">
                                            <p>TODO</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    {% endif %}

                    <!-- Gestion -->

                    {% if is_granted('ROLE_LOCATAIRE') %}
                        {% if realty.idTenant %}
                            {% if realty.statut == 5 %}
                            <div class="col-md-6 col-lg-3 d-flex align-items-stretch mb-5 mb-lg-0 aos-init aos-animate" data-aos="fade-up" data-aos-delay="100">
                                <div class="icon-box" style="width:100%;">
                                    <h4 class="title">Gestion</h4>
                                    <ul class="nav nav-tabs myTab" id="myTab" data-bs-target="#myTabContent2" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="profile" type="button" role="tab" aria-controls="profile" aria-selected="false">Problème</button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="contact" type="button" role="tab" aria-controls="contact" aria-selected="false">Travaux</button>
                                        </li>
                                    </ul>
                                    <div class="tab-content" id="myTabContent2">
                                        <div class="tab-pane fade show active text-center" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                                            <p>todo il n'y a pas de message</p>
                                            {% if not is_granted('ROLE_PROPRIETAIRE') %}
                                                <a href="{{ path('rental.canceled', {idRent: realty.id}) }}" class="btn btn-primary mt-4">{% trans %}Déclarer un problème{% endtrans %}</a>
                                            {% endif %}
                                        </div>
                                        <div class="tab-pane fade text-center" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                                            <p>todo il n'y a pas de message</p>
                                            {% if not is_granted('ROLE_PROPRIETAIRE') %}
                                                <a href="{{ path('rental.accepted', {idRent: realty.id}) }}" class="btn btn-primary mt-4">{% trans %}Demander des travaux{% endtrans %}</a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        {% endif %}
                    {% endif %}

                </div>
            {% endfor %}





            {% if is_granted('ROLE_ADMIN') %}
                <div class="mt-4"><a class="btn btn-primary" href="{{ path('member.home') }}">{% trans %}Accueil{% endtrans %}</a></div>
            {% elseif is_granted('ROLE_AGENCE') %}
                
            {% endif %}
            
                

                

            

        </div>
    </section> 
</main>

{% endblock %}